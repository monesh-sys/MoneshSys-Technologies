<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MoneshSys Secure QR Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #fff;
    text-align: center;
    padding: 20px;
  }
  h1 {
    color: #38bdf8;
  }
  #reader {
    width: 300px;
    margin: auto;
  }
  #result {
    margin-top: 15px;
    padding: 10px;
    background: #020617;
    border-radius: 8px;
    word-break: break-word;
  }
</style>
</head>

<body>

<h1>MoneshSys QR Scanner</h1>
<p>Scan only official MoneshSys QR codes</p>

<div id="reader"></div>
<div id="result">Waiting for scan...</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
  const resultBox = document.getElementById("result");

  function onScanSuccess(qrText) {
    // Check company QR
    if (!qrText.includes("moneshsys.com/scan")) {
      resultBox.innerHTML = "❌ Invalid QR<br>Use MoneshSys QR only";
      return;
    }

    resultBox.innerHTML = "⏳ Verifying...";

    fetch(qrText, {
      method: "GET",
      headers: {
        "X-MoneshSys-Scanner": "true"
      }
    })
    .then(res => {
      if (!res.ok) throw new Error("Unauthorized or invalid QR");
      return res.json();
    })
    .then(data => {
      resultBox.innerHTML = `
        ✅ <b>Valid QR</b><br><br>
        <b>Type:</b> ${data.type}<br>
        <b>ID:</b> ${data.id}<br>
        <b>Status:</b> ${data.status}<br>
        <b>Company:</b> ${data.company}
      `;
    })
    .catch(() => {
      resultBox.innerHTML = "❌ This QR is not authorized for this scanner";
    });
  }

  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    onScanSuccess
  );
</script>

</body>
</html>
